{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/chanchalagorale/Documents/react-mongo-next-project/frontend/components/crud/BlogCreate.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Link from \"next/link\";\nimport { useState, useEffect } from \"react\";\nimport Router from \"next/router\";\nimport dynamic from \"next/dynamic\";\nimport { withRouter } from \"next/router\";\nimport { getCookie, isAuth } from \"../../actions/auth\";\nimport { getCategories } from \"../../actions/category\";\nimport { getTags } from \"../../actions/tag\";\nimport { createBlog } from \"../../actions/blog\";\nconst ReactQuill = dynamic(() => import(\"react-quill\"), {\n  ssr: false,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"react-quill\")],\n    modules: [\"react-quill\"]\n  }\n});\nimport \"../../node_modules/react-quill/dist/quill.snow.css\";\nimport { QuillModules, QuillFormats } from \"../../helpers/quill\";\n\nconst CreateBlog = ({\n  router\n}) => {\n  const blogFromLS = () => {\n    if (true) {\n      return false;\n    }\n\n    if (localStorage.getItem(\"blog\")) {\n      return JSON.parse(localStorage.getItem(\"blog\"));\n    } else {\n      return false;\n    }\n  };\n\n  const {\n    0: categories,\n    1: setCategories\n  } = useState([]);\n  const {\n    0: tags,\n    1: setTags\n  } = useState([]);\n  const {\n    0: checked,\n    1: setChecked\n  } = useState([]); // categories\n\n  const {\n    0: checkedTag,\n    1: setCheckedTag\n  } = useState([]); // tags\n\n  const {\n    0: body,\n    1: setBody\n  } = useState(blogFromLS());\n  const {\n    0: values,\n    1: setValues\n  } = useState({\n    error: \"\",\n    sizeError: \"\",\n    success: \"\",\n    formData: \"\",\n    title: \"\",\n    hidePublishButton: false\n  });\n  const {\n    error,\n    sizeError,\n    success,\n    formData,\n    title,\n    hidePublishButton\n  } = values;\n  const token = getCookie(\"token\");\n  useEffect(() => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      formData: new FormData()\n    }));\n    initCategories();\n    initTags();\n  }, [router]);\n\n  const initCategories = () => {\n    getCategories().then(data => {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setCategories(data);\n      }\n    });\n  };\n\n  const initTags = () => {\n    getTags().then(data => {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setTags(data);\n      }\n    });\n  };\n\n  const publishBlog = e => {\n    e.preventDefault(); // console.log('ready to publishBlog');\n\n    createBlog(formData, token).then(data => {\n      if (data) {\n        if (data.error) {\n          setValues(_objectSpread(_objectSpread({}, values), {}, {\n            error: data.error\n          }));\n        } else {\n          setValues(_objectSpread(_objectSpread({}, values), {}, {\n            title: \"\",\n            error: \"\",\n            success: `A new blog titled \"${data.title}\" is created`\n          }));\n          setBody(\"\");\n          setCategories([]);\n          setTags([]);\n        }\n      } else {\n        console.lo;\n      }\n    });\n  };\n\n  const handleChange = name => e => {\n    // console.log(e.target.value);\n    const value = name === \"photo\" ? e.target.files[0] : e.target.value;\n    formData.set(name, value);\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      [name]: value,\n      formData,\n      error: \"\"\n    }));\n  };\n\n  const handleBody = e => {\n    // console.log(e);\n    setBody(e);\n    formData.set(\"body\", e);\n\n    if (false) {\n      localStorage.setItem(\"blog\", JSON.stringify(e));\n    }\n  };\n\n  const handleToggle = c => () => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      error: \"\"\n    })); // return the first index or -1\n\n    const clickedCategory = checked.indexOf(c);\n    const all = [...checked];\n\n    if (clickedCategory === -1) {\n      all.push(c);\n    } else {\n      all.splice(clickedCategory, 1);\n    }\n\n    console.log(all);\n    setChecked(all);\n    formData.set(\"categories\", all);\n  };\n\n  const handleTagsToggle = t => () => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      error: \"\"\n    })); // return the first index or -1\n\n    const clickedTag = checked.indexOf(t);\n    const all = [...checkedTag];\n\n    if (clickedTag === -1) {\n      all.push(t);\n    } else {\n      all.splice(clickedTag, 1);\n    }\n\n    console.log(all);\n    setCheckedTag(all);\n    formData.set(\"tags\", all);\n  };\n\n  const showCategories = () => {\n    return categories && categories.map((c, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n      className: \"list-unstyled\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        onChange: handleToggle(c._id),\n        type: \"checkbox\",\n        className: \"mr-2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"form-check-label\",\n        children: c.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }, this)]\n    }, i, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }, this));\n  };\n\n  const showTags = () => {\n    return tags && tags.map((t, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n      className: \"list-unstyled\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        onChange: handleTagsToggle(t._id),\n        type: \"checkbox\",\n        className: \"mr-2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"form-check-label\",\n        children: t.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 11\n      }, this)]\n    }, i, true, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 9\n    }, this));\n  };\n\n  const showError = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert alert-danger\",\n    style: {\n      display: error ? \"\" : \"none\"\n    },\n    children: error\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 5\n  }, this);\n\n  const showSuccess = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert alert-success\",\n    style: {\n      display: success ? \"\" : \"none\"\n    },\n    children: success\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 194,\n    columnNumber: 5\n  }, this);\n\n  const createBlogForm = () => {\n    return /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: publishBlog,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"text-muted\",\n          children: \"Title\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"form-control\",\n          value: title,\n          onChange: handleChange(\"title\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: /*#__PURE__*/_jsxDEV(ReactQuill, {\n          modules: QuillModules,\n          formats: QuillFormats,\n          value: body,\n          placeholder: \"Write something amazing...\",\n          onChange: handleBody\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"btn btn-primary\",\n          children: \"Publish\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container-fluid pb-5\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-8\",\n        children: [createBlogForm(), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pt-3\",\n          children: [showError(), showSuccess()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group pb-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n              children: \"Featured image\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n              className: \"text-muted\",\n              children: \"Max size: 1mb\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"btn btn-outline-primary\",\n              children: [\"Upload featured image\", /*#__PURE__*/_jsxDEV(\"input\", {\n                onChange: handleChange(\"photo\"),\n                type: \"file\",\n                accept: \"image/*\",\n                hidden: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            children: \"Categories\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            style: {\n              maxHeight: \"200px\",\n              overflowY: \"scroll\"\n            },\n            children: showCategories()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            children: \"Tags\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            style: {\n              maxHeight: \"200px\",\n              overflowY: \"scroll\"\n            },\n            children: showTags()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 235,\n    columnNumber: 5\n  }, this);\n};\n\nexport default withRouter(CreateBlog);","map":{"version":3,"sources":["/Users/chanchalagorale/Documents/react-mongo-next-project/frontend/components/crud/BlogCreate.js"],"names":["Link","useState","useEffect","Router","dynamic","withRouter","getCookie","isAuth","getCategories","getTags","createBlog","ReactQuill","ssr","QuillModules","QuillFormats","CreateBlog","router","blogFromLS","localStorage","getItem","JSON","parse","categories","setCategories","tags","setTags","checked","setChecked","checkedTag","setCheckedTag","body","setBody","values","setValues","error","sizeError","success","formData","title","hidePublishButton","token","FormData","initCategories","initTags","then","data","publishBlog","e","preventDefault","console","lo","handleChange","name","value","target","files","set","handleBody","setItem","stringify","handleToggle","c","clickedCategory","indexOf","all","push","splice","log","handleTagsToggle","t","clickedTag","showCategories","map","i","_id","showTags","showError","display","showSuccess","createBlogForm","maxHeight","overflowY"],"mappings":"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","sourcesContent":["import Link from \"next/link\";\nimport { useState, useEffect } from \"react\";\nimport Router from \"next/router\";\nimport dynamic from \"next/dynamic\";\nimport { withRouter } from \"next/router\";\nimport { getCookie, isAuth } from \"../../actions/auth\";\nimport { getCategories } from \"../../actions/category\";\nimport { getTags } from \"../../actions/tag\";\nimport { createBlog } from \"../../actions/blog\";\nconst ReactQuill = dynamic(() => import(\"react-quill\"), { ssr: false });\nimport \"../../node_modules/react-quill/dist/quill.snow.css\";\nimport { QuillModules, QuillFormats } from \"../../helpers/quill\";\n\nconst CreateBlog = ({ router }) => {\n  const blogFromLS = () => {\n    if (typeof window === \"undefined\") {\n      return false;\n    }\n\n    if (localStorage.getItem(\"blog\")) {\n      return JSON.parse(localStorage.getItem(\"blog\"));\n    } else {\n      return false;\n    }\n  };\n\n  const [categories, setCategories] = useState([]);\n  const [tags, setTags] = useState([]);\n\n  const [checked, setChecked] = useState([]); // categories\n  const [checkedTag, setCheckedTag] = useState([]); // tags\n\n  const [body, setBody] = useState(blogFromLS());\n  const [values, setValues] = useState({\n    error: \"\",\n    sizeError: \"\",\n    success: \"\",\n    formData: \"\",\n    title: \"\",\n    hidePublishButton: false,\n  });\n\n  const {\n    error,\n    sizeError,\n    success,\n    formData,\n    title,\n    hidePublishButton,\n  } = values;\n  const token = getCookie(\"token\");\n\n  useEffect(() => {\n    setValues({ ...values, formData: new FormData() });\n    initCategories();\n    initTags();\n  }, [router]);\n\n  const initCategories = () => {\n    getCategories().then((data) => {\n      if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setCategories(data);\n      }\n    });\n  };\n\n  const initTags = () => {\n    getTags().then((data) => {\n      if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setTags(data);\n      }\n    });\n  };\n\n  const publishBlog = (e) => {\n    e.preventDefault();\n    // console.log('ready to publishBlog');\n    createBlog(formData, token).then((data) => {\n      if(data){\n        if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setValues({\n          ...values,\n          title: \"\",\n          error: \"\",\n          success: `A new blog titled \"${data.title}\" is created`,\n        });\n        setBody(\"\");\n        setCategories([]);\n        setTags([]);\n      }\n      }else{\n        console.lo\n      }\n      \n    });\n  };\n\n  const handleChange = (name) => (e) => {\n    // console.log(e.target.value);\n    const value = name === \"photo\" ? e.target.files[0] : e.target.value;\n    formData.set(name, value);\n    setValues({ ...values, [name]: value, formData, error: \"\" });\n  };\n\n  const handleBody = (e) => {\n    // console.log(e);\n    setBody(e);\n    formData.set(\"body\", e);\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(\"blog\", JSON.stringify(e));\n    }\n  };\n\n  const handleToggle = (c) => () => {\n    setValues({ ...values, error: \"\" });\n    // return the first index or -1\n    const clickedCategory = checked.indexOf(c);\n    const all = [...checked];\n\n    if (clickedCategory === -1) {\n      all.push(c);\n    } else {\n      all.splice(clickedCategory, 1);\n    }\n    console.log(all);\n    setChecked(all);\n    formData.set(\"categories\", all);\n  };\n\n  const handleTagsToggle = (t) => () => {\n    setValues({ ...values, error: \"\" });\n    // return the first index or -1\n    const clickedTag = checked.indexOf(t);\n    const all = [...checkedTag];\n\n    if (clickedTag === -1) {\n      all.push(t);\n    } else {\n      all.splice(clickedTag, 1);\n    }\n    console.log(all);\n    setCheckedTag(all);\n    formData.set(\"tags\", all);\n  };\n\n  const showCategories = () => {\n    return (\n      categories &&\n      categories.map((c, i) => (\n        <li key={i} className=\"list-unstyled\">\n          <input\n            onChange={handleToggle(c._id)}\n            type=\"checkbox\"\n            className=\"mr-2\"\n          />\n          <label className=\"form-check-label\">{c.name}</label>\n        </li>\n      ))\n    );\n  };\n\n  const showTags = () => {\n    return (\n      tags &&\n      tags.map((t, i) => (\n        <li key={i} className=\"list-unstyled\">\n          <input\n            onChange={handleTagsToggle(t._id)}\n            type=\"checkbox\"\n            className=\"mr-2\"\n          />\n          <label className=\"form-check-label\">{t.name}</label>\n        </li>\n      ))\n    );\n  };\n\n  const showError = () => (\n    <div\n      className=\"alert alert-danger\"\n      style={{ display: error ? \"\" : \"none\" }}\n    >\n      {error}\n    </div>\n  );\n\n  const showSuccess = () => (\n    <div\n      className=\"alert alert-success\"\n      style={{ display: success ? \"\" : \"none\" }}\n    >\n      {success}\n    </div>\n  );\n\n  const createBlogForm = () => {\n    return (\n      <form onSubmit={publishBlog}>\n        <div className=\"form-group\">\n          <label className=\"text-muted\">Title</label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            value={title}\n            onChange={handleChange(\"title\")}\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <ReactQuill\n            modules={QuillModules}\n            formats={QuillFormats}\n            value={body}\n            placeholder=\"Write something amazing...\"\n            onChange={handleBody}\n          />\n        </div>\n\n        <div>\n          <button type=\"submit\" className=\"btn btn-primary\">\n            Publish\n          </button>\n        </div>\n      </form>\n    );\n  };\n\n  return (\n    <div className=\"container-fluid pb-5\">\n      <div className=\"row\">\n        <div className=\"col-md-8\">\n          {createBlogForm()}\n          <div className=\"pt-3\">\n            {showError()}\n            {showSuccess()}\n          </div>\n        </div>\n\n        <div className=\"col-md-4\">\n          <div>\n            <div className=\"form-group pb-2\">\n              <h5>Featured image</h5>\n              <hr />\n\n              <small className=\"text-muted\">Max size: 1mb</small>\n              <br />\n              <label className=\"btn btn-outline-primary\">\n                Upload featured image\n                <input\n                  onChange={handleChange(\"photo\")}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  hidden\n                />\n              </label>\n            </div>\n          </div>\n          <div>\n            <h5>Categories</h5>\n            <hr />\n\n            <ul style={{ maxHeight: \"200px\", overflowY: \"scroll\" }}>\n              {showCategories()}\n            </ul>\n          </div>\n          <div>\n            <h5>Tags</h5>\n            <hr />\n            <ul style={{ maxHeight: \"200px\", overflowY: \"scroll\" }}>\n              {showTags()}\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default withRouter(CreateBlog);\n"]},"metadata":{},"sourceType":"module"}