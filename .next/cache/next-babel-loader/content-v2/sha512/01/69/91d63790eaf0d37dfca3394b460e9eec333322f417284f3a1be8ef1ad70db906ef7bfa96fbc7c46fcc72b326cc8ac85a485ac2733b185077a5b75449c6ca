{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/chanchalagorale/Documents/react-mongo-next-project/frontend/components/crud/BlogUpdate.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Link from \"next/link\";\nimport { useState, useEffect } from \"react\";\nimport Router from \"next/router\";\nimport dynamic from \"next/dynamic\";\nimport { withRouter } from \"next/router\";\nimport { getCookie, isAuth } from \"../../actions/auth\";\nimport { getCategories } from \"../../actions/category\";\nimport { getTags } from \"../../actions/tag\";\nimport { singleBlog, updateBlog } from \"../../actions/blog\";\nconst ReactQuill = dynamic(() => import(\"react-quill\"), {\n  ssr: false,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"react-quill\")],\n    modules: [\"react-quill\"]\n  }\n});\nimport \"../../node_modules/react-quill/dist/quill.snow.css\";\nimport { QuillModules, QuillFormats } from \"../../helpers/quill\";\nlet API = \"http://localhost:8000\";\n\nconst BlogUpdate = ({\n  router\n}) => {\n  const {\n    0: body,\n    1: setBody\n  } = useState(\"\");\n  const {\n    0: categories,\n    1: setCategories\n  } = useState([]);\n  const {\n    0: tags,\n    1: setTags\n  } = useState([]);\n  const {\n    0: checked,\n    1: setChecked\n  } = useState([]); // categories\n\n  const {\n    0: checkedTag,\n    1: setCheckedTag\n  } = useState([]); // tags\n\n  const {\n    0: values,\n    1: setValues\n  } = useState({\n    title: \"\",\n    error: \"\",\n    success: \"\",\n    formData: \"\",\n    title: \"\",\n    body: \"\"\n  });\n  const {\n    error,\n    success,\n    formData,\n    title\n  } = values;\n  const token = getCookie(\"token\");\n  useEffect(() => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      formData: new FormData()\n    }));\n    initBlog();\n    initCategories();\n    initTags();\n  }, [router]);\n\n  const initBlog = () => {\n    if (router.query.slug) {\n      singleBlog(router.query.slug).then(data => {\n        if (data.error) {\n          console.log(data.error);\n        } else {\n          setValues(_objectSpread(_objectSpread({}, values), {}, {\n            title: data.title\n          }));\n          setBody(data.body);\n          setCategoriesArray(data.categories);\n          setTagsArray(data.tags);\n        }\n      });\n    }\n  };\n\n  const setCategoriesArray = blogCategories => {\n    let ca = [];\n    blogCategories.map((c, i) => {\n      ca.push(c._id);\n    });\n    setChecked(ca);\n  };\n\n  const setTagsArray = blogTags => {\n    let ta = [];\n    blogTags.map((t, i) => {\n      ta.push(t._id);\n    });\n    setCheckedTag(ta);\n  };\n\n  const initCategories = () => {\n    getCategories().then(data => {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setCategories(data);\n      }\n    });\n  };\n\n  const initTags = () => {\n    getTags().then(data => {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setTags(data);\n      }\n    });\n  };\n\n  const handleToggle = c => () => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      error: \"\"\n    })); // return the first index or -1\n\n    const clickedCategory = checked.indexOf(c);\n    const all = [...checked];\n\n    if (clickedCategory === -1) {\n      all.push(c);\n    } else {\n      all.splice(clickedCategory, 1);\n    }\n\n    console.log(all);\n    setChecked(all);\n    formData.set(\"categories\", all);\n  };\n\n  const handleTagsToggle = t => () => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      error: \"\"\n    })); // return the first index or -1\n\n    const clickedTag = checkedTag.indexOf(t);\n    const all = [...checkedTag];\n\n    if (clickedTag === -1) {\n      all.push(t);\n    } else {\n      all.splice(clickedTag, 1);\n    }\n\n    console.log(all);\n    setCheckedTag(all);\n    formData.set(\"tags\", all);\n  };\n\n  const findOutCategory = c => {\n    const result = checked.indexOf(c);\n\n    if (result !== -1) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const findOutTag = t => {\n    const result = checkedTag.indexOf(t);\n\n    if (result !== -1) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const showCategories = () => {\n    return categories && categories.map((c, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n      className: \"list-unstyled\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        onChange: handleToggle(c._id),\n        checked: findOutCategory(c._id),\n        type: \"checkbox\",\n        className: \"mr-2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"form-check-label\",\n        children: c.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }, this)]\n    }, i, true, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }, this));\n  };\n\n  const showTags = () => {\n    return tags && tags.map((t, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n      className: \"list-unstyled\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        onChange: handleTagsToggle(t._id),\n        checked: findOutTag(t._id),\n        type: \"checkbox\",\n        className: \"mr-2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"form-check-label\",\n        children: t.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }, this)]\n    }, i, true, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 9\n    }, this));\n  };\n\n  const handleChange = name => e => {\n    // console.log(e.target.value);\n    const value = name === \"photo\" ? e.target.files[0] : e.target.value;\n    formData.set(name, value);\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      [name]: value,\n      formData,\n      error: \"\"\n    }));\n  };\n\n  const handleBody = e => {\n    setBody(e);\n    formData.set(\"body\", e);\n  };\n\n  const editBlog = e => {\n    e.preventDefault();\n    updateBlog(formData, token, router.query.slug).then(data => {\n      if (data.error) {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: data.error\n        }));\n      } else {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          title: \"\",\n          success: `Blog titled \"${data.title}\" is successfully updated`\n        }));\n\n        if (isAuth() && isAuth().role === 1) {\n          // Router.replace(`/admin/crud/${router.query.slug}`);\n          Router.replace(`/admin`);\n        } else if (isAuth() && isAuth().role === 0) {\n          // Router.replace(`/user/crud/${router.query.slug}`);\n          Router.replace(`/user`);\n        }\n      }\n    });\n  };\n\n  const showError = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert alert-danger\",\n    style: {\n      display: error ? \"\" : \"none\"\n    },\n    children: error\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 214,\n    columnNumber: 5\n  }, this);\n\n  const showSuccess = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert alert-success\",\n    style: {\n      display: success ? \"\" : \"none\"\n    },\n    children: success\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 223,\n    columnNumber: 5\n  }, this);\n\n  const updateBlogForm = () => {\n    return /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: editBlog,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"text-muted\",\n          children: \"Title\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"form-control\",\n          value: title,\n          onChange: handleChange(\"title\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        children: /*#__PURE__*/_jsxDEV(ReactQuill, {\n          modules: QuillModules,\n          formats: QuillFormats,\n          value: body,\n          placeholder: \"Write something amazing...\",\n          onChange: handleBody\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"btn btn-primary\",\n          children: \"Update\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container-fluid pb-5\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-8\",\n        children: [updateBlogForm(), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pt-3\",\n          children: [showSuccess(), showError()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 11\n        }, this), body && /*#__PURE__*/_jsxDEV(\"img\", {\n          src: `${API}/blog/photo/${router.query.slug}`,\n          alt: title,\n          style: {\n            width: \"100%\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group pb-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n              children: \"Featured image\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 286,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n              className: \"text-muted\",\n              children: \"Max size: 1mb\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 290,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"btn btn-outline-info\",\n              children: [\"Upload featured image\", /*#__PURE__*/_jsxDEV(\"input\", {\n                onChange: handleChange(\"photo\"),\n                type: \"file\",\n                accept: \"image/*\",\n                hidden: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 293,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 285,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            children: \"Categories\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            style: {\n              maxHeight: \"200px\",\n              overflowY: \"scroll\"\n            },\n            children: showCategories()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            children: \"Tags\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            style: {\n              maxHeight: \"200px\",\n              overflowY: \"scroll\"\n            },\n            children: showTags()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 264,\n    columnNumber: 5\n  }, this);\n};\n\nexport default withRouter(BlogUpdate);","map":{"version":3,"sources":["/Users/chanchalagorale/Documents/react-mongo-next-project/frontend/components/crud/BlogUpdate.js"],"names":["Link","useState","useEffect","Router","dynamic","withRouter","getCookie","isAuth","getCategories","getTags","singleBlog","updateBlog","ReactQuill","ssr","QuillModules","QuillFormats","API","BlogUpdate","router","body","setBody","categories","setCategories","tags","setTags","checked","setChecked","checkedTag","setCheckedTag","values","setValues","title","error","success","formData","token","FormData","initBlog","initCategories","initTags","query","slug","then","data","console","log","setCategoriesArray","setTagsArray","blogCategories","ca","map","c","i","push","_id","blogTags","ta","t","handleToggle","clickedCategory","indexOf","all","splice","set","handleTagsToggle","clickedTag","findOutCategory","result","findOutTag","showCategories","name","showTags","handleChange","e","value","target","files","handleBody","editBlog","preventDefault","role","replace","showError","display","showSuccess","updateBlogForm","width","maxHeight","overflowY"],"mappings":"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","sourcesContent":["import Link from \"next/link\";\nimport { useState, useEffect } from \"react\";\nimport Router from \"next/router\";\nimport dynamic from \"next/dynamic\";\nimport { withRouter } from \"next/router\";\nimport { getCookie, isAuth } from \"../../actions/auth\";\nimport { getCategories } from \"../../actions/category\";\nimport { getTags } from \"../../actions/tag\";\nimport { singleBlog, updateBlog } from \"../../actions/blog\";\nconst ReactQuill = dynamic(() => import(\"react-quill\"), { ssr: false });\nimport \"../../node_modules/react-quill/dist/quill.snow.css\";\nimport { QuillModules, QuillFormats } from \"../../helpers/quill\";\n\nlet API = \"http://localhost:8000\";\n\nconst BlogUpdate = ({ router }) => {\n  const [body, setBody] = useState(\"\");\n\n  const [categories, setCategories] = useState([]);\n  const [tags, setTags] = useState([]);\n\n  const [checked, setChecked] = useState([]); // categories\n  const [checkedTag, setCheckedTag] = useState([]); // tags\n\n  const [values, setValues] = useState({\n    title: \"\",\n    error: \"\",\n    success: \"\",\n    formData: \"\",\n    title: \"\",\n    body: \"\",\n  });\n\n  const { error, success, formData, title } = values;\n  const token = getCookie(\"token\");\n\n  useEffect(() => {\n    setValues({ ...values, formData: new FormData() });\n    initBlog();\n    initCategories();\n    initTags();\n  }, [router]);\n\n  const initBlog = () => {\n    if (router.query.slug) {\n      singleBlog(router.query.slug).then((data) => {\n        if (data.error) {\n          console.log(data.error);\n        } else {\n          setValues({ ...values, title: data.title });\n          setBody(data.body);\n          setCategoriesArray(data.categories);\n          setTagsArray(data.tags);\n        }\n      });\n    }\n  };\n\n  const setCategoriesArray = (blogCategories) => {\n    let ca = [];\n    blogCategories.map((c, i) => {\n      ca.push(c._id);\n    });\n    setChecked(ca);\n  };\n\n  const setTagsArray = (blogTags) => {\n    let ta = [];\n    blogTags.map((t, i) => {\n      ta.push(t._id);\n    });\n    setCheckedTag(ta);\n  };\n\n  const initCategories = () => {\n    getCategories().then((data) => {\n      if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setCategories(data);\n      }\n    });\n  };\n\n  const initTags = () => {\n    getTags().then((data) => {\n      if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setTags(data);\n      }\n    });\n  };\n\n  const handleToggle = (c) => () => {\n    setValues({ ...values, error: \"\" });\n    // return the first index or -1\n    const clickedCategory = checked.indexOf(c);\n    const all = [...checked];\n\n    if (clickedCategory === -1) {\n      all.push(c);\n    } else {\n      all.splice(clickedCategory, 1);\n    }\n    console.log(all);\n    setChecked(all);\n    formData.set(\"categories\", all);\n  };\n\n  const handleTagsToggle = (t) => () => {\n    setValues({ ...values, error: \"\" });\n    // return the first index or -1\n    const clickedTag = checkedTag.indexOf(t);\n    const all = [...checkedTag];\n\n    if (clickedTag === -1) {\n      all.push(t);\n    } else {\n      all.splice(clickedTag, 1);\n    }\n    console.log(all);\n    setCheckedTag(all);\n    formData.set(\"tags\", all);\n  };\n\n  const findOutCategory = (c) => {\n    const result = checked.indexOf(c);\n    if (result !== -1) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const findOutTag = (t) => {\n    const result = checkedTag.indexOf(t);\n    if (result !== -1) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const showCategories = () => {\n    return (\n      categories &&\n      categories.map((c, i) => (\n        <li key={i} className=\"list-unstyled\">\n          <input\n            onChange={handleToggle(c._id)}\n            checked={findOutCategory(c._id)}\n            type=\"checkbox\"\n            className=\"mr-2\"\n          />\n          <label className=\"form-check-label\">{c.name}</label>\n        </li>\n      ))\n    );\n  };\n\n  const showTags = () => {\n    return (\n      tags &&\n      tags.map((t, i) => (\n        <li key={i} className=\"list-unstyled\">\n          <input\n            onChange={handleTagsToggle(t._id)}\n            checked={findOutTag(t._id)}\n            type=\"checkbox\"\n            className=\"mr-2\"\n          />\n          <label className=\"form-check-label\">{t.name}</label>\n        </li>\n      ))\n    );\n  };\n\n  const handleChange = (name) => (e) => {\n    // console.log(e.target.value);\n    const value = name === \"photo\" ? e.target.files[0] : e.target.value;\n    formData.set(name, value);\n    setValues({ ...values, [name]: value, formData, error: \"\" });\n  };\n\n  const handleBody = (e) => {\n    setBody(e);\n    formData.set(\"body\", e);\n  };\n\n  const editBlog = (e) => {\n    e.preventDefault();\n    updateBlog(formData, token, router.query.slug).then((data) => {\n      if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setValues({\n          ...values,\n          title: \"\",\n          success: `Blog titled \"${data.title}\" is successfully updated`,\n        });\n        if (isAuth() && isAuth().role === 1) {\n          // Router.replace(`/admin/crud/${router.query.slug}`);\n          Router.replace(`/admin`);\n        } else if (isAuth() && isAuth().role === 0) {\n          // Router.replace(`/user/crud/${router.query.slug}`);\n          Router.replace(`/user`);\n        }\n      }\n    });\n  };\n\n  const showError = () => (\n    <div\n      className=\"alert alert-danger\"\n      style={{ display: error ? \"\" : \"none\" }}\n    >\n      {error}\n    </div>\n  );\n\n  const showSuccess = () => (\n    <div\n      className=\"alert alert-success\"\n      style={{ display: success ? \"\" : \"none\" }}\n    >\n      {success}\n    </div>\n  );\n\n  const updateBlogForm = () => {\n    return (\n      <form onSubmit={editBlog}>\n        <div className=\"form-group\">\n          <label className=\"text-muted\">Title</label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            value={title}\n            onChange={handleChange(\"title\")}\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <ReactQuill\n            modules={QuillModules}\n            formats={QuillFormats}\n            value={body}\n            placeholder=\"Write something amazing...\"\n            onChange={handleBody}\n          />\n        </div>\n\n        <div>\n          <button type=\"submit\" className=\"btn btn-primary\">\n            Update\n          </button>\n        </div>\n      </form>\n    );\n  };\n\n  return (\n    <div className=\"container-fluid pb-5\">\n      <div className=\"row\">\n        <div className=\"col-md-8\">\n          {updateBlogForm()}\n\n          <div className=\"pt-3\">\n            {showSuccess()}\n            {showError()}\n          </div>\n\n          {body && (\n            <img\n              src={`${API}/blog/photo/${router.query.slug}`}\n              alt={title}\n              style={{ width: \"100%\" }}\n            />\n          )}\n        </div>\n\n        <div className=\"col-md-4\">\n          <div>\n            <div className=\"form-group pb-2\">\n              <h5>Featured image</h5>\n              <hr />\n\n              <small className=\"text-muted\">Max size: 1mb</small>\n              <br />\n              <label className=\"btn btn-outline-info\">\n                Upload featured image\n                <input\n                  onChange={handleChange(\"photo\")}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  hidden\n                />\n              </label>\n            </div>\n          </div>\n          <div>\n            <h5>Categories</h5>\n            <hr />\n\n            <ul style={{ maxHeight: \"200px\", overflowY: \"scroll\" }}>\n              {showCategories()}\n            </ul>\n          </div>\n          <div>\n            <h5>Tags</h5>\n            <hr />\n            <ul style={{ maxHeight: \"200px\", overflowY: \"scroll\" }}>\n              {showTags()}\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default withRouter(BlogUpdate);\n"]},"metadata":{},"sourceType":"module"}